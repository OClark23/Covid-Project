import React, { Component } from 'react';
import { Link } from 'react-router-dom';
import { DeleteButton } from '../components/buttons';
import api from '../api';
import styled from 'styled-components';
import {FaIdCard, FaBookMedical, FaCity, FaPenSquare, FaTrash } from 'react-icons/fa';
import './ItemsPlain.css';

const generateRandomImageWidth = () => {
  // between 40-69, with default of 42
  const randomNumberAsString = Math.random()
    .toString()
    .match(/[4-6]\d/) || ['42'];
  return parseInt(randomNumberAsString) * 10;
};

const generateRandomImageHeight = () => {
  // between 30-59, with default of 36
  const randomNumberAsString = Math.random()
    .toString()
    .match(/[3-5]\d/) || ['36'];
  return parseInt(randomNumberAsString) * 10;
};

const generateRandomCat = () =>
  `https://placekitten.com/${generateRandomImageWidth()}/${generateRandomImageHeight()}`;

const Wrapper = styled.div`
  display: flex;
  flex-wrap: wrap;
  padding: 0 40px 40px 40px;

  @media screen and (max-width: 420px) {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }
`;

const ItemContainer = styled.div`
  align-items: flex-start;
  border: 2px #899499 solid;
  border-radius: 5%;
  display: inline-flex;
  flex-direction: column;
  margin: 1em 2.5% 2em;
  max-width: 20%;
  padding: 1em;
  text-align: left;
  width: 25vw;
  background-color: white;
`;

const ItemImage = styled.img`
  margin: auto;
  max-height: 22em;
  object-fit: contain;
  max-width: 80%;
`;

const NameHeader = styled.h1`
  font-size: 2rem;
  width: 100%;
`;

const DetailParagraph = styled.p`
  width: 100%;
  display:grid;
  align-items: center;
  grid-template-rows: 1fr;
  grid-template-columns: 20px 1fr;
`;

const ButtonsWrapper = styled.div`
  display: flex;
  flex-direction: row;
  justify-content: space-around;
  width: 100%;
`;

class ItemsPlain extends Component {
  constructor(props) {
    super(props);
    this.state = {
      items: {},
    };
  }

  componentDidMount() {
    console.log('ItemsList: props');
    console.log(this.props);
    this.fetchAllPatients();
  }

  fetchAllPatients = () => {
    api
      .getAllPatients()
      .then(resp => {
        const { items } = resp.data;
        console.log('getAllItems: resp');
        console.log(items);
        this.setState({ items });
      })
      .catch(err => {
        console.error(`ERROR in 'getAllItems': ${err}`);
        console.error(err);
        return err;
      });
  };

  deleteSinglePatient = itemId => {
    return api
      .deletePatientById(itemId)
      .then(resp => {
        console.log('deletePatientById: resp');
        console.log(resp);
        return resp;
      })
      .catch(err => {
        console.error(`ERROR in 'deleteSinglePatient': ${err}`);
        console.error(err);
        return err;
      });
  };
  
  handleRemoveItem = data => {
    const itemId = data;

    this.deleteSingleItem(itemId).then(resp => {
      console.log('handleRemoveItem: resp');
      console.log(resp);
      this.fetchAllItems();
    });
  };

  render() {
    const items = this.state.items || {};
    console.log(items);
    
    return(
      <div>
        <div className='svg-title'>
        <svg width="500" height="62" viewBox="0 0 500 62" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M30.875 49H0.15625V4.1875H30.875V13.1562H9.125V22.125H23.8438V31.0938H9.125V40.0312H30.875V49ZM67.0625 49H56.625L49.9688 38.75L43.25 49H32.8125L45.0312 31.8438L32.8125 15.3438H43.25L49.9688 24.9375L56.625 15.3438H67.0625L54.8125 31.8438L67.0625 49ZM101.094 49H99.0312L95.7188 44.4062C94.9062 45.1354 94.0417 45.8229 93.125 46.4688C92.2292 47.0938 91.2812 47.6458 90.2812 48.125C89.2812 48.5833 88.25 48.9479 87.1875 49.2188C86.1458 49.4896 85.0833 49.625 84 49.625C81.6458 49.625 79.4271 49.2292 77.3438 48.4375C75.2812 47.6458 73.4688 46.5 71.9062 45C70.3646 43.4792 69.1458 41.625 68.25 39.4375C67.3542 37.25 66.9062 34.7604 66.9062 31.9688C66.9062 29.3646 67.3542 26.9792 68.25 24.8125C69.1458 22.625 70.3646 20.75 71.9062 19.1875C73.4688 17.625 75.2812 16.4167 77.3438 15.5625C79.4271 14.6875 81.6458 14.25 84 14.25C85.0833 14.25 86.1562 14.3854 87.2188 14.6562C88.2812 14.9271 89.3125 15.3021 90.3125 15.7812C91.3125 16.2604 92.2604 16.8229 93.1562 17.4688C94.0729 18.1146 94.9271 18.8125 95.7188 19.5625L99.0312 15.5938H101.094V49ZM92.5 31.9688C92.5 30.8021 92.2708 29.6771 91.8125 28.5938C91.375 27.4896 90.7708 26.5208 90 25.6875C89.2292 24.8333 88.3229 24.1562 87.2812 23.6562C86.2604 23.1354 85.1667 22.875 84 22.875C82.8333 22.875 81.7292 23.0729 80.6875 23.4688C79.6667 23.8646 78.7708 24.4479 78 25.2188C77.25 25.9896 76.6562 26.9479 76.2188 28.0938C75.7812 29.2188 75.5625 30.5104 75.5625 31.9688C75.5625 33.4271 75.7812 34.7292 76.2188 35.875C76.6562 37 77.25 37.9479 78 38.7188C78.7708 39.4896 79.6667 40.0729 80.6875 40.4688C81.7292 40.8646 82.8333 41.0625 84 41.0625C85.1667 41.0625 86.2604 40.8125 87.2812 40.3125C88.3229 39.7917 89.2292 39.1146 90 38.2812C90.7708 37.4271 91.375 36.4583 91.8125 35.375C92.2708 34.2708 92.5 33.1354 92.5 31.9688ZM150.188 49H141.688V27.75C141.688 27.1667 141.573 26.6146 141.344 26.0938C141.135 25.5729 140.833 25.1146 140.438 24.7188C140.042 24.3229 139.583 24.0208 139.062 23.8125C138.542 23.5833 137.99 23.4688 137.406 23.4688C136.823 23.4688 136.271 23.5833 135.75 23.8125C135.25 24.0208 134.802 24.3229 134.406 24.7188C134.031 25.1146 133.729 25.5729 133.5 26.0938C133.292 26.6146 133.188 27.1667 133.188 27.75V49H124.656V27.75C124.656 27.1667 124.542 26.6146 124.312 26.0938C124.104 25.5729 123.802 25.1146 123.406 24.7188C123.01 24.3229 122.552 24.0208 122.031 23.8125C121.51 23.5833 120.958 23.4688 120.375 23.4688C119.792 23.4688 119.24 23.5833 118.719 23.8125C118.219 24.0208 117.771 24.3229 117.375 24.7188C117 25.1146 116.698 25.5729 116.469 26.0938C116.26 26.6146 116.156 27.1667 116.156 27.75V49H107.625V15.5312H109.688L112 18.0938C113.188 17.0938 114.49 16.3229 115.906 15.7812C117.344 15.2188 118.833 14.9375 120.375 14.9375C121.938 14.9375 123.458 15.2292 124.938 15.8125C126.438 16.3958 127.75 17.4062 128.875 18.8438C129.396 18.1354 129.99 17.5312 130.656 17.0312C131.323 16.5312 132.021 16.125 132.75 15.8125C133.5 15.5 134.271 15.2812 135.062 15.1562C135.854 15.0104 136.635 14.9375 137.406 14.9375C139.177 14.9375 140.833 15.2708 142.375 15.9375C143.938 16.6042 145.292 17.5208 146.438 18.6875C147.604 19.8333 148.521 21.1875 149.188 22.75C149.854 24.3125 150.188 25.9792 150.188 27.75V49ZM184.25 49H175.281V4.1875H184.25V49ZM234.25 49H225.75V27.75C225.75 27.1667 225.635 26.6146 225.406 26.0938C225.198 25.5729 224.896 25.1146 224.5 24.7188C224.104 24.3229 223.646 24.0208 223.125 23.8125C222.604 23.5833 222.052 23.4688 221.469 23.4688C220.885 23.4688 220.333 23.5833 219.812 23.8125C219.312 24.0208 218.865 24.3229 218.469 24.7188C218.094 25.1146 217.792 25.5729 217.562 26.0938C217.354 26.6146 217.25 27.1667 217.25 27.75V49H208.719V27.75C208.719 27.1667 208.604 26.6146 208.375 26.0938C208.167 25.5729 207.865 25.1146 207.469 24.7188C207.073 24.3229 206.615 24.0208 206.094 23.8125C205.573 23.5833 205.021 23.4688 204.438 23.4688C203.854 23.4688 203.302 23.5833 202.781 23.8125C202.281 24.0208 201.833 24.3229 201.438 24.7188C201.062 25.1146 200.76 25.5729 200.531 26.0938C200.323 26.6146 200.219 27.1667 200.219 27.75V49H191.688V15.5312H193.75L196.062 18.0938C197.25 17.0938 198.552 16.3229 199.969 15.7812C201.406 15.2188 202.896 14.9375 204.438 14.9375C206 14.9375 207.521 15.2292 209 15.8125C210.5 16.3958 211.812 17.4062 212.938 18.8438C213.458 18.1354 214.052 17.5312 214.719 17.0312C215.385 16.5312 216.083 16.125 216.812 15.8125C217.562 15.5 218.333 15.2812 219.125 15.1562C219.917 15.0104 220.698 14.9375 221.469 14.9375C223.24 14.9375 224.896 15.2708 226.438 15.9375C228 16.6042 229.354 17.5208 230.5 18.6875C231.667 19.8333 232.583 21.1875 233.25 22.75C233.917 24.3125 234.25 25.9792 234.25 27.75V49ZM272.906 49H270.844L267.531 44.4062C266.719 45.1354 265.854 45.8229 264.938 46.4688C264.042 47.0938 263.094 47.6458 262.094 48.125C261.094 48.5833 260.062 48.9479 259 49.2188C257.958 49.4896 256.896 49.625 255.812 49.625C253.458 49.625 251.24 49.2292 249.156 48.4375C247.094 47.6458 245.281 46.5 243.719 45C242.177 43.4792 240.958 41.625 240.062 39.4375C239.167 37.25 238.719 34.7604 238.719 31.9688C238.719 29.3646 239.167 26.9792 240.062 24.8125C240.958 22.625 242.177 20.75 243.719 19.1875C245.281 17.625 247.094 16.4167 249.156 15.5625C251.24 14.6875 253.458 14.25 255.812 14.25C256.896 14.25 257.969 14.3854 259.031 14.6562C260.094 14.9271 261.125 15.3021 262.125 15.7812C263.125 16.2604 264.073 16.8229 264.969 17.4688C265.885 18.1146 266.74 18.8125 267.531 19.5625L270.844 15.5938H272.906V49ZM264.312 31.9688C264.312 30.8021 264.083 29.6771 263.625 28.5938C263.188 27.4896 262.583 26.5208 261.812 25.6875C261.042 24.8333 260.135 24.1562 259.094 23.6562C258.073 23.1354 256.979 22.875 255.812 22.875C254.646 22.875 253.542 23.0729 252.5 23.4688C251.479 23.8646 250.583 24.4479 249.812 25.2188C249.062 25.9896 248.469 26.9479 248.031 28.0938C247.594 29.2188 247.375 30.5104 247.375 31.9688C247.375 33.4271 247.594 34.7292 248.031 35.875C248.469 37 249.062 37.9479 249.812 38.7188C250.583 39.4896 251.479 40.0729 252.5 40.4688C253.542 40.8646 254.646 41.0625 255.812 41.0625C256.979 41.0625 258.073 40.8125 259.094 40.3125C260.135 39.7917 261.042 39.1146 261.812 38.2812C262.583 37.4271 263.188 36.4583 263.625 35.375C264.083 34.2708 264.312 33.1354 264.312 31.9688ZM303.25 31.9688C303.25 30.8021 303.021 29.6771 302.562 28.5938C302.125 27.4896 301.521 26.5208 300.75 25.6875C299.979 24.8333 299.073 24.1562 298.031 23.6562C297.01 23.1354 295.917 22.875 294.75 22.875C293.583 22.875 292.479 23.0729 291.438 23.4688C290.417 23.8646 289.521 24.4479 288.75 25.2188C288 25.9896 287.406 26.9479 286.969 28.0938C286.531 29.2188 286.312 30.5104 286.312 31.9688C286.312 33.3646 286.531 34.625 286.969 35.75C287.406 36.8542 288 37.8021 288.75 38.5938C289.521 39.3854 290.417 40 291.438 40.4375C292.479 40.8542 293.583 41.0625 294.75 41.0625C295.917 41.0625 297.01 40.8125 298.031 40.3125C299.073 39.7917 299.979 39.1146 300.75 38.2812C301.521 37.4271 302.125 36.4583 302.562 35.375C303.021 34.2708 303.25 33.1354 303.25 31.9688ZM311.844 44.7812C311.844 47.1354 311.396 49.3438 310.5 51.4062C309.604 53.4688 308.375 55.2708 306.812 56.8125C305.271 58.3542 303.458 59.5729 301.375 60.4688C299.312 61.3646 297.104 61.8125 294.75 61.8125L290.469 61.75V53.2188L294.688 53.2812C296.021 53.2812 297.156 53.1042 298.094 52.75C299.031 52.4167 299.823 51.9479 300.469 51.3438C301.115 50.7604 301.625 50.0833 302 49.3125C302.396 48.5417 302.708 47.7292 302.938 46.875C302.604 47.4167 302.125 47.8646 301.5 48.2188C300.875 48.5521 300.177 48.8229 299.406 49.0312C298.656 49.2604 297.865 49.4167 297.031 49.5C296.219 49.5833 295.458 49.625 294.75 49.625C292.396 49.625 290.177 49.2188 288.094 48.4062C286.031 47.5938 284.219 46.4375 282.656 44.9375C281.115 43.4167 279.896 41.5625 279 39.375C278.104 37.1875 277.656 34.7188 277.656 31.9688C277.656 29.4479 278.104 27.1042 279 24.9375C279.896 22.7708 281.115 20.8958 282.656 19.3125C284.219 17.7292 286.031 16.4896 288.094 15.5938C290.177 14.6979 292.396 14.25 294.75 14.25C295.833 14.25 296.906 14.3854 297.969 14.6562C299.031 14.9271 300.062 15.3021 301.062 15.7812C302.062 16.2604 303.01 16.8229 303.906 17.4688C304.823 18.1146 305.677 18.8125 306.469 19.5625L309.781 15.5938H311.844V44.7812ZM331.688 40.8125C332.021 40.9167 332.354 40.9896 332.688 41.0312C333.021 41.0521 333.354 41.0625 333.688 41.0625C334.521 41.0625 335.323 40.9479 336.094 40.7188C336.865 40.4896 337.583 40.1667 338.25 39.75C338.938 39.3125 339.542 38.7917 340.062 38.1875C340.604 37.5625 341.042 36.875 341.375 36.125L347.625 42.4062C346.833 43.5312 345.917 44.5417 344.875 45.4375C343.854 46.3333 342.74 47.0938 341.531 47.7188C340.344 48.3438 339.083 48.8125 337.75 49.125C336.438 49.4583 335.083 49.625 333.688 49.625C331.333 49.625 329.115 49.1875 327.031 48.3125C324.969 47.4375 323.156 46.2188 321.594 44.6562C320.052 43.0938 318.833 41.2396 317.938 39.0938C317.042 36.9271 316.594 34.5521 316.594 31.9688C316.594 29.3229 317.042 26.9062 317.938 24.7188C318.833 22.5312 320.052 20.6667 321.594 19.125C323.156 17.5833 324.969 16.3854 327.031 15.5312C329.115 14.6771 331.333 14.25 333.688 14.25C335.083 14.25 336.448 14.4167 337.781 14.75C339.115 15.0833 340.375 15.5625 341.562 16.1875C342.771 16.8125 343.896 17.5833 344.938 18.5C345.979 19.3958 346.896 20.4062 347.688 21.5312L331.688 40.8125ZM336.062 23.2188C335.667 23.0729 335.271 22.9792 334.875 22.9375C334.5 22.8958 334.104 22.875 333.688 22.875C332.521 22.875 331.417 23.0938 330.375 23.5312C329.354 23.9479 328.458 24.5521 327.688 25.3438C326.938 26.1354 326.344 27.0938 325.906 28.2188C325.469 29.3229 325.25 30.5729 325.25 31.9688C325.25 32.2812 325.26 32.6354 325.281 33.0312C325.323 33.4271 325.375 33.8333 325.438 34.25C325.521 34.6458 325.615 35.0312 325.719 35.4062C325.823 35.7812 325.958 36.1146 326.125 36.4062L336.062 23.2188ZM405.094 4.1875L390.375 49H381.406L366.75 4.1875H376.938L385.875 34.0938L394.844 4.1875H405.094ZM418.562 6.4375C418.562 7.22917 418.406 7.96875 418.094 8.65625C417.802 9.34375 417.396 9.94792 416.875 10.4688C416.354 10.9688 415.74 11.375 415.031 11.6875C414.344 11.9792 413.604 12.125 412.812 12.125C412.021 12.125 411.271 11.9792 410.562 11.6875C409.875 11.375 409.271 10.9688 408.75 10.4688C408.25 9.94792 407.844 9.34375 407.531 8.65625C407.24 7.96875 407.094 7.22917 407.094 6.4375C407.094 5.66667 407.24 4.9375 407.531 4.25C407.844 3.54167 408.25 2.9375 408.75 2.4375C409.271 1.91667 409.875 1.51042 410.562 1.21875C411.271 0.90625 412.021 0.75 412.812 0.75C413.604 0.75 414.344 0.90625 415.031 1.21875C415.74 1.51042 416.354 1.91667 416.875 2.4375C417.396 2.9375 417.802 3.54167 418.094 4.25C418.406 4.9375 418.562 5.66667 418.562 6.4375ZM417.094 49H408.5V15.5312H417.094V49ZM436.938 40.8125C437.271 40.9167 437.604 40.9896 437.938 41.0312C438.271 41.0521 438.604 41.0625 438.938 41.0625C439.771 41.0625 440.573 40.9479 441.344 40.7188C442.115 40.4896 442.833 40.1667 443.5 39.75C444.188 39.3125 444.792 38.7917 445.312 38.1875C445.854 37.5625 446.292 36.875 446.625 36.125L452.875 42.4062C452.083 43.5312 451.167 44.5417 450.125 45.4375C449.104 46.3333 447.99 47.0938 446.781 47.7188C445.594 48.3438 444.333 48.8125 443 49.125C441.688 49.4583 440.333 49.625 438.938 49.625C436.583 49.625 434.365 49.1875 432.281 48.3125C430.219 47.4375 428.406 46.2188 426.844 44.6562C425.302 43.0938 424.083 41.2396 423.188 39.0938C422.292 36.9271 421.844 34.5521 421.844 31.9688C421.844 29.3229 422.292 26.9062 423.188 24.7188C424.083 22.5312 425.302 20.6667 426.844 19.125C428.406 17.5833 430.219 16.3854 432.281 15.5312C434.365 14.6771 436.583 14.25 438.938 14.25C440.333 14.25 441.698 14.4167 443.031 14.75C444.365 15.0833 445.625 15.5625 446.812 16.1875C448.021 16.8125 449.146 17.5833 450.188 18.5C451.229 19.3958 452.146 20.4062 452.938 21.5312L436.938 40.8125ZM441.312 23.2188C440.917 23.0729 440.521 22.9792 440.125 22.9375C439.75 22.8958 439.354 22.875 438.938 22.875C437.771 22.875 436.667 23.0938 435.625 23.5312C434.604 23.9479 433.708 24.5521 432.938 25.3438C432.188 26.1354 431.594 27.0938 431.156 28.2188C430.719 29.3229 430.5 30.5729 430.5 31.9688C430.5 32.2812 430.51 32.6354 430.531 33.0312C430.573 33.4271 430.625 33.8333 430.688 34.25C430.771 34.6458 430.865 35.0312 430.969 35.4062C431.073 35.7812 431.208 36.1146 431.375 36.4062L441.312 23.2188ZM499.5 36.9062C499.5 38.6562 499.167 40.3125 498.5 41.875C497.833 43.4167 496.917 44.7604 495.75 45.9062C494.604 47.0521 493.25 47.9583 491.688 48.625C490.146 49.2917 488.49 49.625 486.719 49.625C485.135 49.625 483.615 49.3542 482.156 48.8125C480.698 48.25 479.375 47.4375 478.188 46.375C477.021 47.4375 475.708 48.25 474.25 48.8125C472.812 49.3542 471.292 49.625 469.688 49.625C467.917 49.625 466.26 49.2917 464.719 48.625C463.177 47.9583 461.823 47.0521 460.656 45.9062C459.51 44.7604 458.604 43.4167 457.938 41.875C457.271 40.3125 456.938 38.6562 456.938 36.9062V15.5938H465.469V36.9062C465.469 37.4896 465.573 38.0417 465.781 38.5625C466.01 39.0625 466.312 39.5104 466.688 39.9062C467.083 40.2812 467.531 40.5833 468.031 40.8125C468.552 41.0208 469.104 41.125 469.688 41.125C470.271 41.125 470.823 41.0208 471.344 40.8125C471.865 40.5833 472.323 40.2812 472.719 39.9062C473.115 39.5104 473.417 39.0625 473.625 38.5625C473.854 38.0417 473.969 37.4896 473.969 36.9062V15.5938H482.469V36.9062C482.469 37.4896 482.583 38.0417 482.812 38.5625C483.042 39.0625 483.344 39.5104 483.719 39.9062C484.115 40.2812 484.562 40.5833 485.062 40.8125C485.583 41.0208 486.135 41.125 486.719 41.125C487.302 41.125 487.854 41.0208 488.375 40.8125C488.896 40.5833 489.344 40.2812 489.719 39.9062C490.115 39.5104 490.427 39.0625 490.656 38.5625C490.885 38.0417 491 37.4896 491 36.9062V15.5938H499.5V36.9062Z" fill="white"/>
</svg>


        </div>
      <div className='ItemContainer'>
      <Wrapper>
        {(items || []).length > 0 
          ? items.map(item => (
                
                <ItemContainer key={item._id}>
                {item.PATIENT_IMAGES.length > 0  ? (
                  <ItemImage src={`https://ohif-hack-diversity-covid.s3.amazonaws.com/covid-png/${item.PATIENT_IMAGES[0].PNG_FILENAME ? item.PATIENT_IMAGES[0].PNG_FILENAME:""}`}></ItemImage>    
                  ):(
                    <ItemImage src={generateRandomCat()}></ItemImage>  
                )}      
                <DetailParagraph>  <FaBookMedical/> Exam ID: <Link data-id={item._id} to={`/item/itemPatientExam/${item._id}`}>{item._id}</Link></DetailParagraph>
                <DetailParagraph> <FaIdCard/> Patient ID: <Link data-patient-id={item._id} to={`/item/patient-info/${item._id}`}>{item.PATIENT_ID}</Link>
                </DetailParagraph>
                <DetailParagraph><FaCity/> Zip: {item.ZIP}</DetailParagraph>
                <ButtonsWrapper>
                <FaPenSquare/>
                   <Link data-update-id={item._id} to={`/item/update/${item._id}`}>
                    Update Item
                  </Link>
                  <FaTrash/> 
                  <DeleteButton id={item._id} onDelete={this.handleRemoveItem} />
                </ButtonsWrapper>
              </ItemContainer>
            
          ))
          : `No items to render... :(`}
      </Wrapper>
      </div>
      </div>
    );
  }
}

export default ItemsPlain;
